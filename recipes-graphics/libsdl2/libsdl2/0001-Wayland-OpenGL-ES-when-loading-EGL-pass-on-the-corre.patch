From ff3f364debfcec3ab502dcc32de6f6fa2e628528 Mon Sep 17 00:00:00 2001
From: Kristian Gunstone <kristian.gunstone@ipec.co.uk>
Date: Wed, 31 May 2023 16:02:01 +0100
Subject: [PATCH] Wayland OpenGL-ES: when loading EGL, pass on the correct
 profile (wayland khr) to trigger EGL version detection

Signed-off-by: Kristian Gunstone <kristian.gunstone@ipec.co.uk>
Upstream-Status: Pending

---
 src/video/wayland/SDL_waylandopengles.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/video/wayland/SDL_waylandopengles.c b/src/video/wayland/SDL_waylandopengles.c
index b7215ed..b51edcf 100644
--- a/src/video/wayland/SDL_waylandopengles.c
+++ b/src/video/wayland/SDL_waylandopengles.c
@@ -37,10 +37,11 @@
 
 int
 Wayland_GLES_LoadLibrary(_THIS, const char *path) {
+    SDL_Log("%s: path=%s,\n", __func__, path);
     int ret;
     SDL_VideoData *data = (SDL_VideoData *) _this->driverdata;
 
-    ret = SDL_EGL_LoadLibrary(_this, path, (NativeDisplayType) data->display, 0);
+    ret = SDL_EGL_LoadLibrary(_this, path, (NativeDisplayType) data->display, EGL_PLATFORM_WAYLAND_KHR);
 
     Wayland_PumpEvents(_this);
     WAYLAND_wl_display_flush(data->display);
@@ -52,6 +53,7 @@ Wayland_GLES_LoadLibrary(_THIS, const char *path) {
 SDL_GLContext
 Wayland_GLES_CreateContext(_THIS, SDL_Window * window)
 {
+    SDL_Log("%s\n", __func__);
     SDL_GLContext context;
     context = SDL_EGL_CreateContext(_this, ((SDL_WindowData *) window->driverdata)->egl_surface);
     WAYLAND_wl_display_flush( ((SDL_VideoData*)_this->driverdata)->display );
